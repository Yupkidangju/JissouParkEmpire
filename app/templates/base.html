<!DOCTYPE html>
<html lang="{{ current_lang() }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ t('site.title') }} - {{ t('site.subtitle') }}">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}{{ t('site.title') }}{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <!-- CRT 스캔라인 오버레이 -->
    <div class="crt-overlay"></div>

    <div class="terminal-container">
        {# [v1.0.0] 언어 선택 드롭다운 #}
        <div class="lang-selector" style="text-align:right; padding:4px 8px; font-size:11px;">
            {{ t('common.lang_select') }}:
            {% for code, name in supported_langs.items() %}
            {% if code == current_lang() %}
            <span style="color:#00ff41; font-weight:bold;">{{ name }}</span>
            {% else %}
            <a href="{{ url_for('set_language', lang_code=code) }}" style="color:#666; text-decoration:none;"
                onmouseover="this.style.color='#00ff41'" onmouseout="this.style.color='#666'">{{ name }}</a>
            {% endif %}
            {% if not loop.last %}<span style="color:#333;">|</span>{% endif %}
            {% endfor %}
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="message-box">
            {% for category, message in messages %}
            <div class="msg msg-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script>
        // [v0.3.0] CSRF 토큰 자동 삽입 - 모든 POST form에 hidden input 추가
        (function () {
            const token = document.querySelector('meta[name="csrf-token"]');
            if (!token) return;
            document.querySelectorAll('form[method="POST"], form[method="post"]').forEach(form => {
                if (!form.querySelector('input[name="csrf_token"]')) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'csrf_token';
                    input.value = token.content;
                    form.appendChild(input);
                }
            });
        })();
    </script>
    {% block scripts %}{% endblock %}
</body>

</html>