# -*- coding: utf-8 -*-
"""
ì‹¤ì¥ì„ ê³µì› ì œêµ­ - ë­í‚¹ í˜ì´ì§€ (ranking.html)
[v0.3.0] ì „íˆ¬ë ¥/ì¸êµ¬/ìŠ¹ë¥  ê¸°ë°˜ ê³µì› ìˆœìœ„ í‘œì‹œ.
"""
{% extends "base.html" %}
{% block title %}{{ t('ranking.title') }} - {{ t('site.title') }}{% endblock %}

{% block content %}
<div class="container">
    <div class="header-row">
        <span>{{ t('ranking.title') }}</span>
        <span>
            <a href="{{ url_for('game.dashboard') }}" class="terminal-link">â† {{ t('nav.dashboard') }}</a>
        </span>
    </div>

    {# ë­í‚¹ íƒ­ #}
    <div class="terminal-box" style="margin-bottom: 12px;">
        <div class="box-content" style="display: flex; gap: 8px;">
            <a href="{{ url_for('game.ranking', sort='power') }}"
                class="terminal-btn {% if sort_by == 'power' %}btn-active{% endif %}">{{ t('ranking.sort.power') }}</a>
            <a href="{{ url_for('game.ranking', sort='population') }}"
                class="terminal-btn {% if sort_by == 'population' %}btn-active{% endif %}">{{
                t('ranking.sort.population') }}</a>
            <a href="{{ url_for('game.ranking', sort='wins') }}"
                class="terminal-btn {% if sort_by == 'wins' %}btn-active{% endif %}">{{ t('ranking.sort.wins') }}</a>
            <a href="{{ url_for('game.ranking', sort='resources') }}"
                class="terminal-btn {% if sort_by == 'resources' %}btn-active{% endif %}">{{ t('ranking.sort.resources')
                }}</a>
        </div>
    </div>

    {# ë­í‚¹ í…Œì´ë¸” #}
    <div class="terminal-box">
        <div class="box-header">ğŸ“Š {{ sort_label }}</div>
        <div class="box-content">
            <table class="park-table ranking-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>{{ t('ranking.park_name') }}</th>
                        <th>{{ t('parks.personality') }}</th>
                        <th>{{ t('ranking.sort.power') }}</th>
                        <th>{{ t('ranking.sort.population') }}</th>
                        <th>{{ t('ranking.sort.wins') }}</th>
                        <th>{{ t('dash.total_np') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in rankings %}
                    <tr
                        class="{% if item.park.id == my_park_id %}my-park-row{% elif item.park.is_npc %}npc-row{% endif %}">
                        <td class="rank-col">
                            {% if loop.index == 1 %}ğŸ¥‡
                            {% elif loop.index == 2 %}ğŸ¥ˆ
                            {% elif loop.index == 3 %}ğŸ¥‰
                            {% else %}{{ loop.index }}
                            {% endif %}
                        </td>
                        <td>
                            {{ item.park.name }}
                            {% if item.park.id == my_park_id %}<span class="my-badge">â˜… {{ t('ranking.my_park')
                                }}</span>{% endif %}
                        </td>
                        <td>
                            {% if item.park.is_npc %}
                            <span class="npc-personality personality-{{ item.park.npc_personality }}">
                                {{ item.personality_emoji }} {{ item.park.npc_personality }}
                            </span>
                            {% else %}
                            <span class="player-badge">ğŸ‘‘ {{ t('parks.player') }}</span>
                            {% endif %}
                        </td>
                        <td class="num-col">{{ item.park.total_combat_power }}</td>
                        <td class="num-col">{{ item.park.total_population }}</td>
                        <td class="num-col">
                            <span class="win-count">{{ item.wins }}</span>
                            /
                            <span class="lose-count">{{ item.losses }}</span>
                        </td>
                        <td class="num-col">{{ item.park.total_np_available }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {# ë‚´ ê³µì› ìš”ì•½ #}
    <div class="terminal-box" style="margin-top: 12px;">
        <div class="box-header">ğŸ“ {{ t('ranking.my_summary') }}</div>
        <div class="box-content">
            <div class="stat-line">{{ t('ranking.sort.power') }}: <strong>{{ my_power_rank }}</strong> / {{ total_parks
                }}</div>
            <div class="stat-line">{{ t('ranking.sort.population') }}: <strong>{{ my_pop_rank }}</strong> / {{
                total_parks }}</div>
            <div class="stat-line">{{ t('ranking.sort.wins') }}: <strong class="win-count">{{ my_wins }}</strong> /
                <strong class="lose-count">{{ my_losses }}</strong></div>
        </div>
    </div>
</div>
{% endblock %}